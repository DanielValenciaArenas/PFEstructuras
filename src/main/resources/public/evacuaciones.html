<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Evacuaciones — Sistema Gestión de Desastres</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>

        :root{
          --glass-bg: rgba(255,255,255,0.06);
          --panel-bg: rgba(255,255,255,0.9);
          --accent: #6c5ce7;
          --danger: #ef4444;
          --muted: #6b7280;
          --glass-border: rgba(255,255,255,0.08);
        }
        html,body{
          height:100%;
          margin:0;
          font-family:Inter,Segoe UI,Roboto,Arial;
          color:#0f172a;
          background: linear-gradient(180deg,#0f172a 0%, #0b1220 60%);
          -webkit-font-smoothing:antialiased;
        }
        .app {
          display:grid;
          grid-template-columns:420px 1fr;
          gap:28px;
          height:100vh;
          padding:28px;
          box-sizing:border-box;
        }

        .panel {
          border-radius:16px;
          padding:20px;
          background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
          border: 1px solid var(--glass-border);
          backdrop-filter: blur(8px) saturate(120%);
          box-shadow: 0 10px 30px rgba(2,6,23,0.6);
          color: #ffffff;
          display:flex;
          flex-direction:column;
          gap:16px;
        }

        .brand {
          display:flex;align-items:center;gap:12px;
        }
        .brand .logo {
          width:44px;height:44px;border-radius:10px;
          background:linear-gradient(135deg,var(--accent),#a78bfa);
          box-shadow:0 6px 18px rgba(108,92,231,0.28);
          display:flex;align-items:center;justify-content:center;font-weight:800;color:white;
          font-size:18px;
        }
        .brand h1 {margin:0;font-size:18px;letter-spacing:0.3px}

        .card {
          background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
          border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);
        }

        .card h2 {margin:0;color:#e6e9f2;font-size:16px}
        .small {color: #cfe0ff; font-size:13px; margin-top:6px}

        .locations {
          margin-top:12px; display:flex; flex-direction:column; gap:10px;
          max-height:260px; overflow:auto; padding-right:6px;
        }

        .loc {
          display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px;
          background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
          border:1px solid rgba(255,255,255,0.02);
          transition: transform .15s, box-shadow .15s;
        }
        .loc:hover { transform: translateY(-4px); box-shadow:0 12px 28px rgba(2,6,23,0.5)}
        .loc .bubble { width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#07112b}
        .lvl1{ background: linear-gradient(135deg,#bbf7d0,#86efac) }
        .lvl3{ background: linear-gradient(135deg,#ffedd5,#ffc58a) }
        .lvl5{ background: linear-gradient(135deg,#ffd6d6,#ff8a8a) }

        .loc .meta {flex:1}
        .loc .meta b{display:block;font-size:15px;color:#f8fafc}
        .loc .meta span{color:var(--muted);font-size:13px}

        .cola-wrap {
          display:flex; flex-direction:column; gap:10px;
        }
        .cola-title { display:flex; justify-content:space-between; align-items:center; }
        .queue {
          display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
        }

        .pill {
          min-width:110px;
          padding:10px 12px;border-radius:999px;
          background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
          border:1px solid rgba(255,255,255,0.03);
          color:white;font-weight:700; display:flex;gap:10px;align-items:center;
          box-shadow:0 6px 18px rgba(2,6,23,0.45);
          transition: transform .12s;
        }
        .pill:hover { transform: translateY(-6px) }

        .priority-dot { width:12px;height:12px;border-radius:50% }
        .dot-high { background: #ff6b6b; box-shadow:0 6px 18px rgba(255,107,107,0.18) }
        .dot-mid  { background: #ffa94d }
        .dot-low  { background: #63e6be }


        .cta {
          display:flex; gap:12px; margin-top:8px;
        }
        .btn {
          background: linear-gradient(90deg,#6c5ce7,#8e7cff);
          color:white;border:none;padding:12px 16px;border-radius:12px;font-weight:700;
          cursor:pointer;box-shadow:0 8px 30px rgba(108,92,231,0.2);transition: transform .12s;
        }
        .btn.secondary {
          background: transparent;border:1px solid rgba(255,255,255,0.06); color:#cfe0ff;
        }
        .btn:active { transform: translateY(2px) }

        .workspace {
          padding:18px;
          display:flex;flex-direction:column; gap:18px;
        }

        .topbar {
          display:flex; justify-content:space-between; align-items:center;
          color:#e6e9ff;
        }
        .title-big { font-size:20px; font-weight:800; letter-spacing:0.3px }

        #map {
          height: 56vh;
          border-radius:16px;
          overflow:hidden;
          box-shadow: 0 20px 60px rgba(2,6,23,0.6)
        }

        .transfer {
          display:flex; gap:14px; align-items:center; padding:14px; border-radius:12px;
          background:linear-gradient(90deg, rgba(124,58,237,0.06), rgba(124,58,237,0.03));
          color:#e9edff;
        }
        .transfer .big { font-size:18px; font-weight:800 }

        .lists-row {
          display:flex;
          gap:20px;
          align-items:flex-start;
          width:100%;
        }

        h3 {
          color:#ffffff;
        }

        .evac-card {
          padding:10px;
          border:1px solid rgba(255,255,255,0.12);
          border-radius:8px;
          background:rgba(255,255,255,0.03);
          display:flex;
          justify-content:space-between;
          align-items:center;
          font-size:14px;
          color:#e5e7eb;
          margin-bottom:8px;
        }

        .evac-info b {
          display:block;
          color:#f9fafb;
        }
        .evac-info small {
          color:#9ca3af;
          display:block;
          margin-top:2px;
        }

        .evac-actions button {
          border:none;
          border-radius:6px;
          padding:4px 8px;
          cursor:pointer;
          font-size:12px;
          margin-left:4px;
        }
        .btn-del {
          background:#ef4444;
          color:white;
        }
        .btn-done {
          background:#22c55e;
          color:white;
        }

        @media (max-width:1050px){
          .app{
            grid-template-columns: 1fr;
            grid-auto-rows: auto 1fr;
            height:auto
          }
          .panel{
            width:100%;
            height:auto;
            border-radius:12px
          }
          #map{ height: 48vh }
        }
    </style>
</head>
<body>

<div class="app">
    <aside class="panel" aria-label="Panel lateral de evacuaciones">
        <div class="brand">
            <div class="logo">ED</div>
            <h1>Evacuaciones </h1>
        </div>
        <div class="card">
            <h2>Ubicaciones</h2>
            <div class="small">Zona afectada y refugios (traído del servidor)</div>
            <div id="locations" class="locations" style="margin-top:12px"></div>
            <div style="margin-top:10px;color:var(--muted);font-size:12px">
                Haz clic en una ubicación para seleccionarla en el mapa.
            </div>
        </div>
        <div class="card cola-wrap">
            <div class="cola-title">
                <h2>Cola de Prioridad</h2>
                <div class="small">Mayor prioridad → primero</div>
            </div>

            <div id="queue" class="queue" style="margin-top:8px"></div>

            <div style="margin-top:10px;font-size:13px;color:var(--muted)">
                Las tarjetas muestran las evacuaciones en cola. Puedes eliminarlas o planificarlas.
            </div>
        </div>
        <div class="card">
            <h2>Planificación</h2>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <select id="selectOrigen" style="flex:1"></select>
                <select id="selectDestino" style="flex:1"></select>
            </div>
            <div style="display:flex;margin-top:10px;gap:8px">
                <button class="btn" id="btnPlan">▶️ Planificar (auto)</button>
                <button class="btn secondary" id="btnManual">✚ Añadir a cola</button>
            </div>
            <div style="margin-top:8px;font-size:13px;color:var(--muted)">
                <b>Planificar</b> toma la evacuación de mayor prioridad y la pasa a la lista de planificadas.
            </div>
        </div>

        <div style="flex:1"></div>

        <div style="text-align:center;color:rgba(255,255,255,0.55);font-size:12px">
            ©️ Proyecto — Gestión de Desastres
        </div>
    </aside>

    <main class="workspace">
        <div class="topbar">
            <div>
                <div class="title-big">Módulo: Evacuaciones</div>
                <div style="color:#cfe0ff;font-size:13px">
                    Visión centralizada — cola priorizada — planificación
                </div>
            </div>

            <div>
                <button class="btn secondary" id="btnRefresh">Actualizar</button>
            </div>
        </div>

        <div id="map"></div>

        <div class="lists-row">

            <div style="flex:1;">
                <h3 style="margin-top:12px;">Evacuaciones Planificadas</h3>
                <div id="evacPlan"></div>
            </div>

            <div style="flex:1;">
                <h3 style="margin-top:12px;">Evacuaciones Completadas</h3>
                <div id="evacDone"></div>
            </div>

        </div>

        <div id="transferResult" class="transfer" style="display:none">
            <div>
                <div style="color:var(--muted);font-size:12px">Última planificación</div>
                <div class="big" id="transferText"></div>
            </div>
        </div>

    </main>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>


    let ubicaciones = [];
    let listaEvacuaciones = [];
    let cola = [];
    let planificadas = [];
    let completadas = [];

    let map, layerGroup;


    map = L.map('map', {zoomControl:true}).setView([4.535, -75.675], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    layerGroup = L.layerGroup().addTo(map);


    const elLocations = document.getElementById('locations');
    const elQueue = document.getElementById('queue');
    const selOrigen = document.getElementById('selectOrigen');
    const selDestino = document.getElementById('selectDestino');
    const btnPlan = document.getElementById('btnPlan');
    const btnManual = document.getElementById('btnManual');
    const btnRefresh = document.getElementById('btnRefresh');
    const transferDiv = document.getElementById('transferResult');
    const transferText = document.getElementById('transferText');

    const elEvacPlan = document.getElementById('evacPlan');
    const elEvacDone = document.getElementById('evacDone');


    function textoEstado(e) {
        if (e === 'PENDIENTE') return 'Pendiente (en cola)';
        if (e === 'EN_PROCESO') return 'Planificada';
        if (e === 'COMPLETADA') return 'Completada';
        return e || '';
    }

    // ---------- Cargar datos iniciales ----------
    async function init(){
      await Promise.all([cargarUbicaciones(), cargarEvacuaciones()]);
      renderAll();
    }
    init();

    async function cargarUbicaciones(){
      try {
        const r = await fetch('/api/ubicaciones');
        if (!r.ok) { ubicaciones = []; return; }
        ubicaciones = await r.json();
      } catch (e) {
        console.error('Error cargando ubicaciones', e);
        ubicaciones = [];
      }
    }

    async function cargarEvacuaciones(){
      try {
        const r = await fetch('/api/evacuaciones');
        if (!r.ok) {
          listaEvacuaciones = [];
          cola = planificadas = completadas = [];
          return;
        }
        const lista = await r.json();
        listaEvacuaciones = Array.isArray(lista) ? lista : [];

        cola        = listaEvacuaciones.filter(ev => ev.estado === 'PENDIENTE');
        planificadas= listaEvacuaciones.filter(ev => ev.estado === 'EN_PROCESO');
        completadas = listaEvacuaciones.filter(ev => ev.estado === 'COMPLETADA');

      } catch (e) {
        console.error('Error cargando evacuaciones', e);
        listaEvacuaciones = [];
        cola = planificadas = completadas = [];
      }
    }

        // Cargar y sincronizar el número de personas de una ubicación
    async function sincronizarPersonasUbicacion(u, cardDiv, marker) {
      if (!u || !u.nombre) return;
      try {
        const resp = await fetch(`/api/personas?ubicacion=${encodeURIComponent(u.nombre)}`);
        if (!resp.ok) return;

        const lista = await resp.json();
        const total = Array.isArray(lista) ? lista.length : 0;

        // Actualizar contador en la tarjeta de la columna izquierda
        if (cardDiv) {
          const span = cardDiv.querySelector('.personas-count');
          if (span) {
            span.textContent = total;
          }
        }

        // Actualizar también el popup del marcador en el mapa
        if (marker) {
          marker.setPopupContent(
            '<b>' + (u.nombre || '') + '</b><br>' +
            'Personas: ' + total + '<br>' +
            (u.tipoZona || '')
          );
        }
      } catch (err) {
        console.error('Error sincronizando personas de', u.nombre, err);
      }
    }


    function renderLocations(){
      elLocations.innerHTML = '';
      layerGroup.clearLayers();
      selOrigen.innerHTML = '';
      selDestino.innerHTML = '';

      ubicaciones.forEach((u, i) => {
        let lvlClass = 'lvl1';
        const nivel = u.nivelAfectacion || (u.nivel || 'LEVE');
        if (nivel === 'GRAVE' || nivel === 'ALTO' || nivel === '5') lvlClass = 'lvl5';
        else if (nivel === 'MODERADO' || nivel === '3') lvlClass = 'lvl3';


                const div = document.createElement('div');
        div.className = 'loc';

        const personas = u.personas ?? u.cantidadPersonas ?? 0;

        div.innerHTML = `
          <div class="bubble ${lvlClass}">${u.nombre && u.nombre[0] ? u.nombre[0].toUpperCase() : 'U'}</div>
          <div class="meta">
            <b>${u.nombre}</b>
            <span>${u.tipoZona || ''} • ${u.nivelAfectacion || ''}</span>
          </div>
          <div style="text-align:right">
            <div style="font-weight:800;color:#e6eefc">
              <span class="personas-count" data-ubicacion="${u.nombre}">${personas}</span>
            </div>
            <div style="font-size:12px;color:var(--muted)">personas</div>
          </div>
        `;

        div.addEventListener('click', ()=> {
          const lat = u.latitud ?? u.lat ?? (u.coords && u.coords[0]);
          const lng = u.longitud ?? u.lng ?? (u.coords && u.coords[1]);
          if (lat != null && lng != null) {
            map.flyTo([lat,lng],15,{duration:0.8});
          }
        });

        elLocations.appendChild(div);

        const opt1 = document.createElement('option');
        opt1.value = i; opt1.text = u.nombre;
        const opt2 = document.createElement('option');
        opt2.value = i; opt2.text = u.nombre;
        selOrigen.appendChild(opt1);
        selDestino.appendChild(opt2);


        const lat = parseFloat(u.latitud ?? u.lat ?? (u.coords && u.coords[0]) ?? 0);
        const lng = parseFloat(u.longitud ?? u.lng ?? (u.coords && u.coords[1]) ?? 0);
        if (!isNaN(lat) && !isNaN(lng)) {
          const color = (nivel==='GRAVE' || nivel==='5') ? '#ff6b6b'
                        : ((nivel==='MODERADO' || nivel==='3') ? '#ffa94d' : '#63e6be');
          const marker = L.circleMarker([lat,lng], {
            radius: 10,
            fillColor: color,
            color: '#fff',
            weight:2,
            fillOpacity:0.95
          }).bindPopup(
            '<b>'+ (u.nombre || '') + '</b><br>' +
            'Personas: ' + personas + '<br>' +
            (u.tipoZona || '')
          );
          layerGroup.addLayer(marker);

          sincronizarPersonasUbicacion(u, div, marker);
        }
      });
    }

    function renderQueue() {
      elQueue.innerHTML = '';

      if (!cola || cola.length === 0) {
        elQueue.innerHTML =
          '<div style="color:#cfe0ff;font-size:13px">La cola está vacía</div>';
        return;
      }

      cola.forEach(ev => {
        const pill = document.createElement('div');
        pill.className = 'pill';

        const dot = document.createElement('div');
        const pr = ev.prioridad ?? 0;
        dot.className = 'priority-dot ' + (
          pr >= 4 ? 'dot-high' : (pr >= 2 ? 'dot-mid' : 'dot-low')
        );
        pill.appendChild(dot);

        const txt = document.createElement('div');
        txt.innerHTML = `
          <div style="font-size:13px">${ev.ubicacion || '(sin ubicación)'}</div>
          <div style="font-size:12px;color:var(--muted)">
            ${ev.personas ?? ev.cantidadPersonas ?? 0} personas • prio ${pr}<br>
            ${textoEstado(ev.estado)}
          </div>
        `;
        pill.appendChild(txt);

        // botón eliminar
        const btnDel = document.createElement('button');
        btnDel.textContent = 'X';
        btnDel.className = 'btn-del';
        btnDel.style.marginLeft = 'auto';

        btnDel.addEventListener('click', async (e) => {
          e.stopPropagation();
          if (!ev.id) return;
          if (!confirm('¿Eliminar esta evacuación de la cola?')) return;
          try {
            const res = await fetch('/api/evacuaciones?id=' + encodeURIComponent(ev.id), {
              method: 'DELETE'
            });
            if (!res.ok) {
              alert('No se pudo eliminar en el servidor.');
              return;
            }
            await cargarEvacuaciones();
            renderAll();
          } catch(err) {
            console.error('Error eliminando evacuación', err);
            alert('Error de comunicación con el servidor.');
          }
        });

        pill.appendChild(btnDel);

        pill.addEventListener('click', () => {
          const ub = ubicaciones.find(u => u.nombre === ev.ubicacion);
          if (ub) {
            const lat = ub.latitud ?? ub.lat ?? (ub.coords && ub.coords[0]);
            const lng = ub.longitud ?? ub.lng ?? (ub.coords && ub.coords[1]);
            if (lat != null && lng != null) {
              map.flyTo([lat,lng], 15, { duration: 0.7 });
            }
          }
        });

        elQueue.appendChild(pill);
      });
    }


    function renderPlanificadas() {
      elEvacPlan.innerHTML = '';

      if (!planificadas || planificadas.length === 0) {
        elEvacPlan.innerHTML =
          '<div style="color:#cfe0ff;font-size:13px">Sin evacuaciones planificadas.</div>';
        return;
      }

      planificadas.forEach(ev => {
        const card = document.createElement('div');
        card.className = 'evac-card';

        const info = document.createElement('div');
        info.className = 'evac-info';
        info.innerHTML = `
          <b>${ev.ubicacion || '(sin ubicación)'}</b>
          <small>
            ${ev.personas ?? ev.cantidadPersonas ?? 0} personas • prioridad ${ev.prioridad ?? 0}<br>
            Estado: ${textoEstado(ev.estado)}
          </small>
        `;

        const actions = document.createElement('div');
        actions.className = 'evac-actions';

        // botón completar
        const btnDone = document.createElement('button');
        btnDone.textContent = '✔';
        btnDone.className = 'btn-done';
        btnDone.title = 'Marcar como completada';

        btnDone.addEventListener('click', async () => {
          if (!ev.id) return;
          try {
            const res = await fetch('/api/evacuaciones', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ id: ev.id, estado: 'COMPLETADA' })
            });
            if (!res.ok) {
              alert('No se pudo actualizar el estado en el servidor.');
              return;
            }
            await cargarEvacuaciones();
            renderAll();
          } catch (err) {
            console.error('Error completando evacuación', err);
            alert('Error de comunicación con el servidor.');
          }
        });

        // botón eliminar planificada
        const btnDel = document.createElement('button');
        btnDel.textContent = 'X';
        btnDel.className = 'btn-del';
        btnDel.title = 'Eliminar definitivamente';

        btnDel.addEventListener('click', async () => {
          if (!ev.id) return;
          if (!confirm('¿Eliminar esta evacuación planificada?')) return;
          try {
            const res = await fetch('/api/evacuaciones?id=' + encodeURIComponent(ev.id), {
              method: 'DELETE'
            });
            if (!res.ok) {
              alert('No se pudo eliminar en el servidor.');
              return;
            }
            await cargarEvacuaciones();
            renderAll();
          } catch (err) {
            console.error('Error eliminando evacuación', err);
            alert('Error de comunicación con el servidor.');
          }
        });

        actions.appendChild(btnDel);
        actions.appendChild(btnDone);
        card.appendChild(info);
        card.appendChild(actions);
        elEvacPlan.appendChild(card);
      });
    }


    function renderCompletadas() {
      elEvacDone.innerHTML = '';

      if (!completadas || completadas.length === 0) {
        elEvacDone.innerHTML =
          '<div style="color:#cfe0ff;font-size:13px">Sin evacuaciones completadas.</div>';
        return;
      }

      completadas.forEach(ev => {
        const card = document.createElement('div');
        card.className = 'evac-card';

        const info = document.createElement('div');
        info.className = 'evac-info';
        info.innerHTML = `
          <b>${ev.ubicacion || '(sin ubicación)'}</b>
          <small>
            ${ev.personas ?? ev.cantidadPersonas ?? 0} personas • prioridad ${ev.prioridad ?? 0}<br>
            Estado: ${textoEstado(ev.estado)}
          </small>
        `;

        const actions = document.createElement('div');
        actions.className = 'evac-actions';

        // botón eliminar completada
        const btnDel = document.createElement('button');
        btnDel.textContent = 'X';
        btnDel.className = 'btn-del';
        btnDel.title = 'Eliminar registro';

        btnDel.addEventListener('click', async () => {
          if (!ev.id) return;
          if (!confirm('¿Eliminar esta evacuación completada?')) return;
          try {
            const res = await fetch('/api/evacuaciones?id=' + encodeURIComponent(ev.id), {
              method: 'DELETE'
            });
            if (!res.ok) {
              alert('No se pudo eliminar en el servidor.');
              return;
            }
            await cargarEvacuaciones();
            renderAll();
          } catch (err) {
            console.error('Error eliminando evacuación', err);
            alert('Error de comunicación con el servidor.');
          }
        });

        actions.appendChild(btnDel);
        card.appendChild(info);
        card.appendChild(actions);
        elEvacDone.appendChild(card);
      });
    }

    function renderAll() {
      renderLocations();
      renderQueue();
      renderPlanificadas();
      renderCompletadas();
    }

    btnManual.addEventListener('click', async () => {
      const ubic = prompt('Nombre de la ubicación a evacuar (exacto):');
      if (!ubic) return;
      const prio = parseInt(prompt('Prioridad (1 baja - 5 alta)', '3'), 10);
      const pers = parseInt(prompt('Cantidad de personas a evacuar', '10'), 10);
      if (!pers || pers <= 0) {
        alert('Cantidad inválida');
        return;
      }

      try {
        const body = { ubicacion: ubic, prioridad: prio, personas: pers };
        const res = await fetch('/api/evacuaciones', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        if (!res.ok) {
          const txt = await res.text();
          console.warn('POST evac error', txt);
          alert('Error añadiendo evacuación.');
          return;
        }
        await cargarEvacuaciones();
        renderAll();
      } catch(err) {
        console.error(err);
        alert('Error comunicando con servidor.');
      }
    });


    btnPlan.addEventListener('click', async () => {
      btnPlan.disabled = true;
      btnPlan.textContent = 'Ejecutando...';
      try {
        const res = await fetch('/api/evacuaciones/planificar', { method:'POST' });
        if (!res.ok) {
          alert('No se pudo planificar en el servidor.');
          return;
        }
        const detalle = await res.json().catch(() => null);
        if (detalle && detalle.ubicacion) {
          transferText.textContent =
            `Se planificó evacuación en ${detalle.ubicacion} ` +
            `(${detalle.personas || detalle.cantidadPersonas || 0} personas).`;
          transferDiv.style.display = 'flex';
        }
        await cargarEvacuaciones();
        renderAll();
      } catch(err) {
        console.error('Error al planificar', err);
        alert('Error de comunicación con el servidor.');
      } finally {
        btnPlan.disabled = false;
        btnPlan.textContent = '▶️ Planificar (auto)';
      }
    });

    btnRefresh.addEventListener('click', async () => {
      await Promise.all([cargarUbicaciones(), cargarEvacuaciones()]);
      renderAll();
    });

    setInterval(async () => {
      try {
        await cargarEvacuaciones();
        renderQueue();
        renderPlanificadas();
        renderCompletadas();
      } catch {}
    }, 12000);
</script>

</body>
</html>